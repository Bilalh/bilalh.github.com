(function(q){q.fn.adGallery=function(o){var d={loader_image:"/images/gallery/loader.gif",start_at_index:0,description_wrapper:false,thumb_opacity:0.7,animate_first_image:false,animation_speed:400,width:false,height:false,display_next_and_prev:true,display_back_and_forward:true,scroll_jump:0,slideshow:{enable:true,autostart:false,speed:5000,start_label:"Start",stop_label:"Stop",stop_on_scroll:true,countdown_prefix:"(",countdown_sufix:")",onStart:false,onStop:false},effect:"slide-hori",enable_keyboard_move:true,cycle:true,callbacks:{init:false,afterImageVisible:false,beforeImageVisible:false}};var s=q.extend(false,d,o);if(o&&o.slideshow)s.slideshow=q.extend(false,d.slideshow,o.slideshow);;if(!s.slideshow.enable)s.slideshow.autostart=false;;var a=[];q(this).each(function(){var g=new A(this,s);a[a.length]=g});return a};function V(i,a,d){var c=parseInt(i.css("top"),10);if(a=="left"){var o="-"+this.image_wrapper_height+"px";i.css("top",this.image_wrapper_height+"px")}else{var o=this.image_wrapper_height+"px";i.css("top","-"+this.image_wrapper_height+"px")};if(d){d.css("bottom","-"+d[0].offsetHeight+"px");d.animate({bottom:0},this.settings.animation_speed*2)};if(this.current_description)this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},this.settings.animation_speed*2);;return{old_image:{top:o},new_image:{top:c}}};function H(i,a,d){var c=parseInt(i.css("left"),10);if(a=="left"){var o="-"+this.image_wrapper_width+"px";i.css("left",this.image_wrapper_width+"px")}else{var o=this.image_wrapper_width+"px";i.css("left","-"+this.image_wrapper_width+"px")};if(d){d.css("bottom","-"+d[0].offsetHeight+"px");d.animate({bottom:0},this.settings.animation_speed*2)};if(this.current_description)this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},this.settings.animation_speed*2);;return{old_image:{left:o},new_image:{left:c}}};function R(i,f,e){var a=i.width();var b=i.height();var d=parseInt(i.css("left"),10);var c=parseInt(i.css("top"),10);i.css({width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2});return{old_image:{width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2},new_image:{width:a,height:b,top:c,left:d}}};function F(i,d,a){i.css("opacity",0);return{old_image:{opacity:0},new_image:{opacity:1}}};function N(i,d,a){i.css("opacity",0);return{old_image:{opacity:0},new_image:{opacity:1},speed:0}};function A(w,s){this.init(w,s)};A.prototype={wrapper:false,image_wrapper:false,gallery_info:false,nav:false,loader:false,preloads:false,thumbs_wrapper:false,scroll_back:false,scroll_forward:false,next_link:false,prev_link:false,slideshow:false,image_wrapper_width:0,image_wrapper_height:0,current_index:0,current_image:false,current_description:false,nav_display_width:0,settings:false,images:false,in_transition:false,animations:false,init:function(w,b){var a=this;this.wrapper=q(w);this.settings=b;this.setupElements();this.setupAnimations();if(this.settings.width){this.image_wrapper_width=this.settings.width;this.image_wrapper.width(this.settings.width);this.wrapper.width(this.settings.width)}else this.image_wrapper_width=this.image_wrapper.width();;if(this.settings.height){this.image_wrapper_height=this.settings.height;this.image_wrapper.height(this.settings.height)}else this.image_wrapper_height=this.image_wrapper.height();;this.nav_display_width=this.nav.width();this.current_index=0;this.current_image=false;this.current_description=false;this.in_transition=false;this.findImages();if(this.settings.display_next_and_prev)this.initNextAndPrev();;var n=function(c){return a.nextImage(c)};this.slideshow=new u(n,this.settings.slideshow);this.controls.append(this.slideshow.create());if(this.settings.slideshow.enable)this.slideshow.enable();else this.slideshow.disable();;if(this.settings.display_back_and_forward)this.initBackAndForward();;if(this.settings.enable_keyboard_move)this.initKeyEvents();;var s=parseInt(this.settings.start_at_index,10);if(window.location.hash&&window.location.hash.indexOf("#ad-image")===0){s=window.location.hash.replace(/[^0-9]+/g,'');if((s*1)!=s)s=this.settings.start_at_index;};this.loading(true);this.showImage(s,function(){if(a.settings.slideshow.autostart){a.preloadImage(s+1);a.slideshow.start()}});this.fireCallback(this.settings.callbacks.init)},setupAnimations:function(){this.animations={"slide-vert":V,"slide-hori":H,"resize":R,"fade":F,"none":N}},setupElements:function(){this.controls=this.wrapper.find(".ad-controls");this.gallery_info=q('<p class="ad-info"></p>');this.controls.append(this.gallery_info);this.image_wrapper=this.wrapper.find(".ad-image-wrapper");this.image_wrapper.empty();this.nav=this.wrapper.find(".ad-nav");this.thumbs_wrapper=this.nav.find(".ad-thumbs");this.preloads=q('<div class="ad-preloads"></div>');this.loader=q('<img class="ad-loader" src="'+this.settings.loader_image+'">');this.image_wrapper.append(this.loader);this.loader.hide();q(document.body).append(this.preloads)},loading:function(b){if(b)this.loader.show();else this.loader.hide();},addAnimation:function(n,f){if(q.isFunction(f))this.animations[n]=f;},findImages:function(){var e=this;this.images=[];var f=0;var g=0;var h=this.thumbs_wrapper.find("a");var k=h.length;if(this.settings.thumb_opacity<1)h.find("img").css("opacity",this.settings.thumb_opacity);;h.each(function(b){var l=q(this);var c=l.attr("href");var t=l.find("img");if(!e.isImageLoaded(t[0]))t.load(function(){f+=this.parentNode.parentNode.offsetWidth;g++});else{f+=t[0].parentNode.parentNode.offsetWidth;g++};l.addClass("ad-thumb"+b);l.click(function(){e.showImage(b);e.slideshow.stop();return false}).hover(function(){if(!q(this).is(".ad-active")&&e.settings.thumb_opacity<1)q(this).find("img").fadeTo(300,1);;e.preloadImage(b)},function(){if(!q(this).is(".ad-active")&&e.settings.thumb_opacity<1)q(this).find("img").fadeTo(300,e.settings.thumb_opacity);});var l=false;if(t.data("ad-link"))l=t.data("ad-link");else if(t.attr("longdesc")&&t.attr("longdesc").length)l=t.attr("longdesc");;var d=false;if(t.data("ad-desc"))d=t.data("ad-desc");else if(t.attr("alt")&&t.attr("alt").length)d=t.attr("alt");;var a=false;if(t.data("ad-title"))a=t.data("ad-title");else if(t.attr("title")&&t.attr("title").length)a=t.attr("title");;e.images[b]={thumb:t.attr("src"),image:c,error:false,preloaded:false,desc:d,title:a,size:false,link:l}});var j=setInterval(function(){if(k==g){f-=100;var l=e.nav.find(".ad-thumb-list");l.css("width",f+"px");var i=1;var a=l.height();while(i<201){l.css("width",(f+i)+"px");if(a!=l.height())break;a=l.height();i++}clearInterval(j)}},100)},initKeyEvents:function(){var c=this;q(document).keydown(function(a){if(a.keyCode==39){c.nextImage();c.slideshow.stop()}else if(a.keyCode==37){c.prevImage();c.slideshow.stop()}})},initNextAndPrev:function(){this.next_link=q('<div class="ad-next"><div class="ad-next-image"></div></div>');this.prev_link=q('<div class="ad-prev"><div class="ad-prev-image"></div></div>');this.image_wrapper.append(this.next_link);this.image_wrapper.append(this.prev_link);var c=this;this.prev_link.add(this.next_link).mouseover(function(e){q(this).css("height",c.image_wrapper_height);q(this).find("div").show()}).mouseout(function(e){q(this).find("div").hide()}).click(function(){if(q(this).is(".ad-next")){c.nextImage();c.slideshow.stop()}else{c.prevImage();c.slideshow.stop()}}).find("div").css("opacity",0.7)},initBackAndForward:function(){var c=this;this.scroll_forward=q('<div class="ad-forward"></div>');this.scroll_back=q('<div class="ad-back"></div>');this.nav.append(this.scroll_forward);this.nav.prepend(this.scroll_back);var h=0;var t=false;q(this.scroll_back).add(this.scroll_forward).click(function(){var w=c.nav_display_width-50;if(c.settings.scroll_jump>0)var w=c.settings.scroll_jump;;if(q(this).is(".ad-forward"))var l=c.thumbs_wrapper.scrollLeft()+w;else var l=c.thumbs_wrapper.scrollLeft()-w;;if(c.settings.slideshow.stop_on_scroll)c.slideshow.stop();;c.thumbs_wrapper.animate({scrollLeft:l+"px"});return false}).css("opacity",0.6).hover(function(){var d="left";if(q(this).is(".ad-forward"))d="right";;t=setInterval(function(){h++;if(h>30&&c.settings.slideshow.stop_on_scroll)c.slideshow.stop();;var l=c.thumbs_wrapper.scrollLeft()+1;if(d=="left")l=c.thumbs_wrapper.scrollLeft()-1;;c.thumbs_wrapper.scrollLeft(l)},10);q(this).css("opacity",1)},function(){h=0;clearInterval(t);q(this).css("opacity",0.6)})},_afterShow:function(){this.gallery_info.html((this.current_index+1)+" / "+this.images.length);if(!this.settings.cycle){this.prev_link.show().css("height",this.image_wrapper_height);this.next_link.show().css("height",this.image_wrapper_height);if(this.current_index==(this.images.length-1))this.next_link.hide();;if(this.current_index==0)this.prev_link.hide();};this.fireCallback(this.settings.callbacks.afterImageVisible)},_getContainedImageSize:function(a,i){if(i>this.image_wrapper_height){var r=a/i;i=this.image_wrapper_height;a=this.image_wrapper_height*r};if(a>this.image_wrapper_width){var r=i/a;a=this.image_wrapper_width;i=this.image_wrapper_width*r};return{width:a,height:i}},_centerImage:function(i,b,a){i.css("top","0px");if(a<this.image_wrapper_height){var d=this.image_wrapper_height-a;i.css("top",(d/2)+"px")};i.css("left","0px");if(b<this.image_wrapper_width){var d=this.image_wrapper_width-b;i.css("left",(d/2)+"px")}},_getDescription:function(i){var d=false;if(i.desc.length||i.title.length){var t='';if(i.title.length)t='<strong class="ad-description-title">'+i.title+"</strong>";;var d='';if(i.desc.length)d="<span>"+i.desc+"</span>";;d=q('<p class="ad-image-description">'+t+d+"</p>")};return d},showImage:function(i,b){if(this.images[i]&&!this.in_transition){var c=this;var a=this.images[i];this.in_transition=true;if(!a.preloaded){this.loading(true);this.preloadImage(i,function(){c.loading(false);c._showWhenLoaded(i,b)})}else this._showWhenLoaded(i,b);}},_showWhenLoaded:function(e,m){if(this.images[e]){var c=this;var b=this.images[e];var i=q(document.createElement("div")).addClass("ad-image");var f=q(new Image()).attr("src",b.image);if(b.link){var l=q('<a href="'+b.link+'" target="_blank"></a>');l.append(f);i.append(l)}else i.append(f);this.image_wrapper.prepend(i);var s=this._getContainedImageSize(b.size.width,b.size.height);f.attr("width",s.width);f.attr("height",s.height);i.css({width:s.width+"px",height:s.height+"px"});this._centerImage(i,s.width,s.height);var d=this._getDescription(b,i);if(d){if(!this.settings.description_wrapper){i.append(d);var w=s.width-parseInt(d.css("padding-left"),10)-parseInt(d.css("padding-right"),10);d.css("width",w+"px")}else this.settings.description_wrapper.append(d)};this.highLightThumb(this.nav.find(".ad-thumb"+e));var j="right";if(this.current_index<e)j="left";;this.fireCallback(this.settings.callbacks.beforeImageVisible);if(this.current_image||this.settings.animate_first_image){var h=this.settings.animation_speed;var g="swing";var a=this.animations[this.settings.effect].call(this,i,j,d);if(typeof a.speed!="undefined")h=a.speed;;if(typeof a.easing!="undefined")g=a.easing;;if(this.current_image){var k=this.current_image;var o=this.current_description;k.animate(a.old_image,h,g,function(){k.remove();if(o)o.remove()})};i.animate(a.new_image,h,g,function(){c.current_index=e;c.current_image=i;c.current_description=d;c.in_transition=false;c._afterShow();c.fireCallback(m)})}else{this.current_index=e;this.current_image=i;c.current_description=d;this.in_transition=false;c._afterShow();this.fireCallback(m)}}},nextIndex:function(){if(this.current_index==(this.images.length-1)){if(!this.settings.cycle)return false;;var n=0}else var n=this.current_index+1;;return n},nextImage:function(c){var n=this.nextIndex();if(n===false)return false;this.preloadImage(n+1);this.showImage(n,c);return true},prevIndex:function(){if(this.current_index==0){if(!this.settings.cycle)return false;;var p=this.images.length-1}else var p=this.current_index-1;;return p},prevImage:function(c){var p=this.prevIndex();if(p===false)return false;this.preloadImage(p-1);this.showImage(p,c);return true},preloadAll:function(){var c=this;var i=0;function p(){if(i<c.images.length){i++;c.preloadImage(i,p)}};c.preloadImage(i,p)},preloadImage:function(b,c){if(this.images[b]){var i=this.images[b];if(!this.images[b].preloaded){var a=q(new Image());a.attr("src",i.image);if(!this.isImageLoaded(a[0])){this.preloads.append(a);var d=this;a.load(function(){i.preloaded=true;i.size={width:this.width,height:this.height};d.fireCallback(c)}).error(function(){i.error=true;i.preloaded=false;i.size=false})}else{i.preloaded=true;i.size={width:a[0].width,height:a[0].height};this.fireCallback(c)}}else this.fireCallback(c);}},isImageLoaded:function(i){if(typeof i.complete!="undefined"&&!i.complete)return false;;if(typeof i.naturalWidth!="undefined"&&i.naturalWidth==0)return false;;return true},highLightThumb:function(t){this.thumbs_wrapper.find(".ad-active").removeClass("ad-active");t.addClass("ad-active");if(this.settings.thumb_opacity<1){this.thumbs_wrapper.find("a:not(.ad-active) img").fadeTo(300,this.settings.thumb_opacity);t.find("img").fadeTo(300,1)};var l=t[0].parentNode.offsetLeft;l-=(this.nav_display_width/2)-(t[0].offsetWidth/2);this.thumbs_wrapper.animate({scrollLeft:l+"px"})},fireCallback:function(f){if(q.isFunction(f))f.call(this);}};function u(n,s){this.init(n,s)};u.prototype={start_link:false,stop_link:false,countdown:false,controls:false,settings:false,nextimage_callback:false,enabled:false,running:false,countdown_interval:false,init:function(n,s){var c=this;this.nextimage_callback=n;this.settings=s},create:function(){this.start_link=q('<span class="ad-slideshow-start">'+this.settings.start_label+"</span>");this.stop_link=q('<span class="ad-slideshow-stop">'+this.settings.stop_label+"</span>");this.countdown=q('<span class="ad-slideshow-countdown"></span>');this.controls=q('<div class="ad-slideshow-controls"></div>');this.controls.append(this.start_link).append(this.stop_link).append(this.countdown);this.countdown.hide();var c=this;this.start_link.click(function(){c.start()});this.stop_link.click(function(){c.stop()});q(document).keydown(function(a){if(a.keyCode==83){if(c.running)c.stop();else c.start();}});return this.controls},disable:function(){this.enabled=false;this.stop();this.controls.hide()},enable:function(){this.enabled=true;this.controls.show()},toggle:function(){if(this.enabled)this.disable();else this.enable();},start:function(){if(this.running||!this.enabled)return false;var c=this;this.running=true;this.controls.addClass("ad-slideshow-running");this._next();this.fireCallback(this.settings.onStart);return true},stop:function(){if(!this.running)return false;this.running=false;this.countdown.hide();this.controls.removeClass("ad-slideshow-running");clearInterval(this.countdown_interval);this.fireCallback(this.settings.onStop);return true},_next:function(){var c=this;var p=this.settings.countdown_prefix;var b=this.settings.countdown_sufix;clearInterval(c.countdown_interval);this.countdown.show().html(p+(this.settings.speed/1000)+b);var a=0;this.countdown_interval=setInterval(function(){a+=1000;if(a>=c.settings.speed){var w=function(){if(c.running)c._next();;a=0};if(!c.nextimage_callback(w))c.stop();;a=0};var s=parseInt(c.countdown.text().replace(/[^0-9]/g,''),10);s--;if(s>0)c.countdown.html(p+s+b);},1000)},fireCallback:function(f){if(q.isFunction(f))f.call(this);}}})(jQuery);